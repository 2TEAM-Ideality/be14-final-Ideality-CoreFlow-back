<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <style>
        @page {
            size: A4;
            margin: 0;
            @bottom-right {
                content: counter(page);
                font-size: 12px;
                color: #888;
            }
        }

        @font-face {
            font-family: 'NotoSansKR';
            src: url('../fonts/NotoSansKR-Regular.ttf') format('truetype');
        }

        /* 테이블 데이터가 페이지를 넘어가도 유효하도록 */
        thead {
            display: table-header-group;
        }
        tfoot {
            display: table-footer-group;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0;
            padding: 0;
            counter-reset: page;
        }
        /* 커버 스타일 */
        .cover-page {
            background-color: #2D4E9B;
            color: white;
            padding: 50px;
            height: 297mm;
            box-sizing: border-box;
        }

        .logo {
            width: 150px;
            margin-bottom: 50px;
        }
        .report-type {
            font-size: 15px;
            padding-bottom: 50px;
            margin-bottom: 100px;
        }

        .project-title {
            font-size: 32px;
            font-weight: 600;
            margin: 10px 0 30px 0;
        }

        .meta-info {
            font-size: 14px;
            margin-bottom: 4px;
        }

        .line {
            width: 100%;
            height: 2px;
            background-color: #ffffff;
            margin: 16px 0 32px 0;
        }
        .sub-line {
            height: 2px;
            width: 70%;
            background-color: white;
            margin: 13px 0 15px 0;
        }


        .contents-title {
            color: #FFD600;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .content-container {
            margin-top: 200px;

        }
        .sub-title {
            margin-top: 10px;
            margin-bottom: 10px;
            color: #001560;
            font-weight: bold;
            font-size: 12px;
        }
        .contents {
            width: 100%;
            text-align: justify;
            justify-content: space-between;
        }

        .content-block {
            display: inline-block;
            width: 23%;
            margin-right: 1%;
            vertical-align: top;
        }

        .content-number {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .content-title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .content-subtext {
            font-size: 12px;
            color: #e0e0e0;
            line-height: 1.4;
        }

        .page-break {
            page-break-after: always;
        }

        /* 요약 페이지 스타일 */
        .summary-page {
            background-color: white;
            color: black;
            padding: 50px;
            height: 297mm;
            box-sizing: border-box;
        }

        .section-title {
            font-size: 22px;
            font-weight: bold;
            color: #001560;
            border-bottom: 2px solid #001560;
            padding-bottom: 10px;
        }

        .info-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 5px;
        }

        .info-table th, .info-table td {
            font-size: 10px;
            border: 1px solid #ccc;
            padding: 8px 12px;
            text-align: left;
        }

        .info-table th {
            background-color: #f2f2f2;
        }

        /* 작업 공정 페이지  */
        .process-page {
            background-color: white;
            color: black;
            padding: 50px;
            height: 297mm;
            box-sizing: border-box;
        }
        .process-table td {
            padding: 4px 6px;
            height: auto;
        }

        /*  지연 분석 페이지   */
        .delay-page {
            background-color: white;
            color: black;
            padding: 50px;
            height: 297mm;
            box-sizing: border-box;
        }

    </style>
</head>
<body>

<!-- 🟦 Cover Page (1페이지) -->
<div class="cover-page">
    <div class="logo-header">
        <img th:src="'data:image/png;base64,' + ${coverLogo}" class="logo" alt="Core Flow Logo" />
    </div>

    <p class="project-title" th:text="${name}"></p>

    <p class="meta-info">작성일자&nbsp;&nbsp;&nbsp; <span th:text="${createdAt}"></span></p>
    <p class="meta-info">총괄 책임자&nbsp;&nbsp;&nbsp; <span th:text="${director}"></span></p>

    <div class="line"></div>

    <div class="content-container">
        <p class="contents-title">Contents :</p>
        <div class="contents">
            <div class="content-block">
                <p class="content-number">01</p>
                <div class="sub-line"></div>
                <p class="content-title">프로젝트 개요</p>
                <p class="content-subtext">프로젝트명<br />수행 기간<br />관리자</p>
            </div>
            <div class="content-block">
                <p class="content-number">02</p>
                <div class="sub-line"></div>
                <p class="content-title">작업 공정</p>
                <p class="content-subtext">전체 일정 요약<br />공정별 진행률 및 일정<br />주요 마일스톤 리스트</p>
            </div>
            <div class="content-block">
                <p class="content-number">03</p>
                <div class="sub-line"></div>
                <p class="content-title">지연 분석</p>
                <p class="content-subtext">전체 지연 기간 분석<br />지연 원인 분석<br />지연 사유서 목록</p>
            </div>
            <div class="content-block">
                <p class="content-number">04</p>
                <div class="sub-line"></div>
                <p class="content-title">성과 평가</p>
                <p class="content-subtext">전체 납기 준수율<br />평균 지연일 / 성과 비교<br />주요 산출물 목록<br />향후 개선 사항</p>
            </div>
        </div>
    </div>
</div>

<div class="page-break"></div>

<!-- ⬜ 01 챕터 - 프로젝트 요약 페이지 (1) -->
<div class="summary-page">
    <div class="logo-header">
        <img th:src="'data:image/png;base64,' + ${contentLogo}"
             alt="Core Flow Logo"
             style="height: 40px; width: auto;" />
    </div>

    <p class="section-title">01 프로젝트 개요</p>

    <div class="sub-title" style="margin-top: 30px;">
        프로젝트 요약
    </div>
    <table class="info-table">
        <tr>
            <th>프로젝트명</th>
            <td><strong>26FW 한화 이글스 콜라보 프로젝트</strong></td>
        </tr>
        <tr>
            <th>설명</th>
            <td>2025년 S/S 시즌 신제품으로 기획된 패션 자켓의 개발 프로젝트</td>
        </tr>
        <tr>
            <th>총괄 관리자</th>
            <td>홍길동 기획팀 팀장</td>
        </tr>
        <tr>
            <th>진행 기간</th>
            <td>2025-03-01 ~ 2025-03-31 (총 31일)</td>
        </tr>
        <tr>
            <th>작성 일자</th>
            <td>2025-04-01</td>
        </tr>
        <tr>
            <th>지연일</th>
            <td>1일</td>
        </tr>
    </table>

    <!-- 참여자 목록 -->
    <div class="sub-title" style="margin-top: 30px;">
        부서별 참여자
    </div>
    <table class="info-table">
        <tr th:each="team : ${teamList}">
            <th th:text="${team.name + ' (' + team.count + ')'}">디자인 팀 (3)</th>
            <td>
                <div><strong>책임자</strong> <span th:text="${team.manager}">홍길동</span></div>
                <div th:each="member : ${team.members}">
                    <span th:text="${member}">홍길동</span><br />
                </div>
            </td>
        </tr>
    </table>

</div>

<div class="page-break"></div>

<!-- ⬜ 02 챕터 - 작업 공정 페이지 (2 ~) -->
<div th:each="page, stat : ${pagedTaskList}">
    <div class="process-page">
        <!-- 로고 + 제목 -->
        <div class="logo-header">
            <img th:src="'data:image/png;base64,' + ${contentLogo}"
                 alt="Core Flow Logo"
                 style="height: 40px; width: auto;" />
        </div>

        <p class="section-title"
           th:text="${stat.index == 0} ? '02 작업 공정' : ''"></p>

        <div class="sub-title">작업 공정 내역 -
            <span th:text="${stat.index + 1}"></span>
        </div>

        <table class="info-table process-table">
            <thead>
            <tr>
                <th style="width: 15px; padding: 3px"></th>
                <th>업무</th>
                <th>완료율</th>
                <th>베이스라인</th>
                <th>실제 작업 기간</th>
                <th>계획 대비</th>
                <th>상태</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="task , idx: ${page}">
                <td th:text="${idx.index + 1 + (stat.index * 15)}"></td>
                <td th:text="${task.taskName}">패턴 생성</td>
                <td th:text="${task.progress} + '%'">95%</td>
                <td th:text="${task.baseStart} + ' ~ ' + ${task.baseEnd}">2025-03-05 ~ 2025-03-08</td>
                <td th:text="${task.realStart} + ' ~ ' + ${task.realEnd}">2025-03-05 ~ 2025-03-09</td>
                <td th:text="'+' + ${task.delay} + '일'"
                    th:style="${task.delay > 0} ? 'color: red;' : ''">+1일</td>
                <td th:text="${task.status}">지연</td>
            </tr>
            </tbody>
        </table>

        <!-- 총계 정보: 마지막 페이지에만 표시 -->
        <div class="sub-title" th:if="${stat.last}">
            작업 공정 결과
        </div>
        <table class="process-result info-table" th:if="${stat.last}">
            <thead>
            <tr>
                <th>전체 태스크</th>
                <th>완료율</th>
                <th>베이스라인</th>
                <th>실제 작업 기간</th>
                <th>계획 대비</th>
                <th>상태</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td style="font-weight: bold;">총계 <span th:text="${taskList.size()}"></span></td>
                <td th:text="${total['progress']} + '%'" style="font-weight: bold;">98%</td>
                <td th:text="${total['baseStart']} + ' ~ ' + ${total['baseEnd']}">2025-03-01 ~ 2025-03-21</td>
                <td th:text="${total['realStart']} + ' ~ ' + ${total['realEnd']}">2025-03-01 ~ 2025-03-31</td>
                <td th:text="'+' + ${total['delay']} + '일'"
                    th:style="${total['delay']} > 0 ? 'color: red;' : ''">+10일</td>
                <td th:text="${total['status']}">지연</td>
            </tr>
            </tbody>

        </table>


        <div class="page-break"></div>
    </div>

</div>
<div class="page-break"></div>


<!-- ⬜ 03 챕터 - 지연 분석 페이지 (다중 페이지 지원) -->
<div th:each="page, stat : ${pagedDelayReportList}">
    <div class="delay-page">
        <div class="logo-header">
            <img th:src="'data:image/png;base64,' + ${contentLogo}"
                 alt="Core Flow Logo"
                 style="height: 40px; width: auto;" />
        </div>


        <p class="section-title" th:text="${stat.index == 0} ? '03 지연 분석' : ''"></p>

        <div class="chart-section" th:if="${stat.index == 0}">
            <div style="display: inline-block; width: 45%;">
                <p class="sub-title">지연 태스크 분석</p>
                <img th:src="'data:image/png;base64,' + ${pieChartBase64}" width="100%" />
            </div>
            <div style="display: inline-block; width: 45%;">
                <p class="sub-title">지연 사유 분석</p>
                <img th:src="'data:image/png;base64,' + ${delayReasonChart}" width="100%" />
            </div>
        </div>

        <div class="sub-title" style="margin-top: 30px;">지연 사유서 내역 - <span th:text="${stat.index + 1}"></span></div>
        <table class="info-table">
            <thead>
            <tr>
                <th>업무 구분(태스크명)</th>
                <th>생성일</th>
                <th>결재자</th>
                <th>파일 링크</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="item : ${page}">
                <td th:text="${item.taskName}">패턴 생성</td>
                <td th:text="${item.createdAt}">2025-03-08</td>
                <td th:text="${item.approver}">홍길동 기획팀 팀장</td>
                <td><a th:href="${item.fileUrl}">LINK</a></td>
            </tr>
            </tbody>
        </table>
    </div>
    <div class="page-break"></div>
</div>

<div class="page-break"></div>
<div th:each="page, stat : ${pagedOutputList}">
    <div class="delay-page">
        <div class="logo-header">
            <img th:src="'data:image/png;base64,' + ${contentLogo}"
                 alt="Core Flow Logo"
                 style="height: 40px; width: auto;" />
        </div>

        <p class="section-title" th:text="${stat.index == 0} ? '04 성과 평가' : ''"></p>

        <!-- 평가 요약 정보는 첫 페이지에만 -->
        <div th:if="${stat.index == 0}">
            <div class="sub-title">성과 평가</div>
            <table class="info-table">
                <tr>
                    <th>전체 납기 준수율</th>
                    <th>전체 태스크</th>
                    <th>태스크별 평균 지연일</th>
                    <th>총 지연일</th>
                </tr>
                <tr>
                    <td style="color: #0A84FF; font-weight: bold;">92.4%</td>
                    <td>24</td>
                    <td style="color: red;">+2.4일</td>
                    <td style="color: red;">+10일</td>
                </tr>
            </table>

            <div class="sub-title" style="margin-top: 20px;">주요 병목 공정</div>
            <div style="font-size: 12px;">자켓 봉제, 프린트</div>
        </div>

        <div class="sub-title" style="margin-top: 20px;">산출물 목록</div>
        <!-- 산출물 목록 테이블 -->
        <table class="info-table">
            <thead>
            <tr>
                <th>관련 태스크</th>
                <th>산출물 명</th>
                <th>등록자</th>
                <th>등록일</th>
                <th>미리보기</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="item : ${page}">
                <td th:text="${item.task}">자켓 봉제</td>
                <td th:text="${item.filename}">제품기획서.pdf</td>
                <td th:text="${item.uploader}">기획팀 김하늘</td>
                <td th:text="${item.uploadDate}">2025-05-01</td>
                <td><a th:href="${item.fileUrl}">LINK</a></td>
            </tr>
            </tbody>
        </table>
    </div>
    <div class="page-break"></div>
</div>



</body>
</html>
